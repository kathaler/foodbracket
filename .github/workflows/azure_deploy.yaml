name: Deploy to Azure

on:
  push:
    branches:
      - main

jobs:
   build-and-deploy:
      runs-on: ubuntu-latest

      steps:
         - name: Checkout repository
           uses: actions/checkout@v2
         
         - name: Setup Node.js
           uses: actions/setup-node@v2
           with:
            node-version: '16'

         - name: Install dependencies
           run: npm install

         - name: Build
           run: npm run build

         - name: Setup Git Credentials
           run: |
             git config --global user.email "kthaler@calpoly.edu"
             git config --global user.name "kathaler"
             git remote add azure https://$AZURE_USERNAME:$AZURE_PASSWORD@foodbracket.scm.azurewebsites.net:443/foodbracket.git
     

         - name: Push to Azure Local Git
           run: |
             git push azure main
           env:
             AZURE_USERNAME: ${{ secrets.AZURE_USERNAME }}
             AZURE_PASSWORD: ${{ secrets.AZURE_PASSWORD }}